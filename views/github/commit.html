<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>GitHub â†’ Notion Summary</title>

    <link rel="stylesheet" href="/commit-style.css" />
    <link rel="stylesheet" href="/common-style.css" />
</head>
<body>
<div class="wrap">

    <button class="backBtn backBtn--floating" id="btnBack" type="button" aria-label="ì´ì „">
        <span class="backIcon">â†</span>
        <span class="backText">ì´ì „</span>
    </button>

    <!-- LEFT -->
    <section class="panel" id="leftPanel">
        <div>
            <h2>GitHub</h2>
            <div class="muted">ë ˆí¬ì§€í† ë¦¬ ì •ë³´ + ë‚ ì§œ ë²”ìœ„(2ê°œ)ë§Œ í‘œì‹œ</div>
        </div>

        <div class="repoBox" id="repoBox">
            <div class="repoTop">
                <div class="repoName" id="repoName">owner/repository</div>
                <span class="pill" id="repoVisibility">public</span>
            </div>
            <div class="repoMeta">
                <div id="repoDesc">ë ˆí¬ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                <div class="mt-5"></div>
                <div>â­ <span id="repoStars">0</span> Â· ğŸ´ <span id="repoForks">0</span> Â· ğŸ•’ <span id="repoUpdated">-</span></div>
            </div>
        </div>

        <div class="field">
            <label for="commitDate">Choose Commit Date</label>
            <input id="commitDate" type="date" />
        </div>

        <div class="btnRow">
            <button class="primary" id="createSummary">Commit ìš”ì•½ â†’</button>
        </div>
    </section>

    <!-- ARROW -->
    <div class="arrowCol" aria-hidden="true">
        <div class="arrow" title="GitHub to Notion">
            âœ
        </div>
    </div>

    <!-- RIGHT -->
    <section class="panel" id="rightPanel">
        <div>
            <h2>Notion</h2>
            <div class="muted">ì¢…ë¥˜ ì„ íƒ + ì…ë ¥ ë‚ ì§œ + ìš”ì•½ í‘œì‹œ/ìˆ˜ì •</div>
        </div>

        <div class="field">
            <label for="notionType">ë…¸ì…˜ ì¢…ë¥˜</label>
            <select id="notionType">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="daylog">Day Log</option>
                <option value="nlog">nlog</option>
                <option value="meeting">Meeting Notes</option>
            </select>
        </div>

        <div class="field">
            <label for="notionDate">ì…ë ¥ ë‚ ì§œ</label>
            <input id="notionDate" type="date" />
        </div>

        <div class="field">
            <label for="summaryArea">ì»¤ë°‹ ìš”ì•½ (í‘œì‹œ & ìˆ˜ì •)</label>
            <textarea id="summaryArea" placeholder="ì—¬ê¸°ì— ì»¤ë°‹ ìš”ì•½ ë‚´ìš©ì´ ì±„ì›Œì§€ê³ , ìˆ˜ì •ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤."></textarea>
        </div>

        <div class="btnRow">
            <button class="primary" id="notionGenerate">ìš”ì•½ í˜ì´ì§€ ìƒì„± â†’</button>
        </div>
    </section>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        initEvent();
        loadRepo();
    });

    function initEvent(){
        // ë‚ ì§œ ì´ˆê¸°ê°’ ì„¤ì •
        $("commitDate").value = toISODate(new Date());
        $("notionDate").value = toISODate(new Date());

        // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById("btnBack").addEventListener("click", () => {
            window.location.href="/repo";
        });

        // Commit ìš”ì•½ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById("createSummary").addEventListener("click", () => {
            createSummary();
        });
    }

    async function loadRepo(){

        const location = new URL(window.location.href);
        const pattern = new URLPattern({pathname: "/commit/:owner/:name"});
        const match = pattern.exec(location);
        const {owner, name} = match.pathname.groups;

        const url = `/api/github/repo/${owner}/${name}`;
        const result = await fetch(url);

        state.repo = await result.json();
        setRepoUI(state.repo);
    }

    // ====== Demo state (ë‚˜ì¤‘ì— ì‹¤ì œ API ë¶™ì¼ ë•Œ ì—¬ê¸°ë§Œ êµì²´í•˜ë©´ ë¨) ======
    const state = {
        repo: null,
    };

    const $ = (id) => document.getElementById(id);

    function setRepoUI(repo) {
        state.repo = repo;
        $("repoName").textContent = repo.full_name ?? "owner/repository";
        $("repoVisibility").textContent = repo.visibility ?? "public";
        $("repoDesc").textContent = repo.description ?? "ë ˆí¬ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.";
        $("repoStars").textContent = String(repo.stargazers_count ?? 0);
        $("repoForks").textContent = String(repo.forks_count ?? 0);
        $("repoUpdated").textContent = repo.updated_at
            ? new Date(repo.updated_at).toLocaleString()
            : "-";
    }

    function toISODate(d) {
        // input[type=date] ìš© yyyy-mm-dd
        const pad = (n) => String(n).padStart(2, "0");
        return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }

    function createSummary(){
        if (!state.repo) {
            // ë ˆí¬ ì •ë³´ëŠ” "í‘œì‹œ"ê°€ ëª©ì ì´ë¼ì„œ, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ì´ë¼ë„ ì§„í–‰
            setRepoUI({
                full_name: "owner/repository",
                visibility: "public",
                description: "ë ˆí¬ ì •ë³´ë¥¼ ì•„ì§ ë¡œë“œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
                stargazers_count: 0,
                forks_count: 0,
                updated_at: null,
            });
        }

        const repoName = state.repo?.full_name ?? "owner/repository";
        const notionType = $("notionType").value || "(ë…¸ì…˜ ì¢…ë¥˜ ë¯¸ì„ íƒ)";
        const notionDate = $("notionDate").value || "(ì…ë ¥ ë‚ ì§œ ë¯¸ì§€ì •)";
    }

    // ====== Events ======

/*
        const demoSummary =
            `[ìš”ì•½ ë°ëª¨]
- Repo: ${repoName}
- Range: ${fromDate} ~ ${toDate}
- NotionType: ${notionType}
- NotionDate: ${notionDate}

- ë³€ê²½ì‚¬í•­:
  - í•µì‹¬ ë¡œì§ ìˆ˜ì • 2ê±´
  - ë²„ê·¸ ìˆ˜ì • 1ê±´
  - ë¦¬íŒ©í† ë§ 1ê±´

- ë©”ëª¨:
  - ì•„ë˜ ë‚´ìš©ì„ ì›í•˜ëŠ” ëŒ€ë¡œ ìˆ˜ì •í•œ ë’¤ Notion ë“±ë¡ ë¡œì§ì— ë„˜ê¸°ë©´ ë¨.`;

        $("summaryArea").value = demoSummary;
        $("summaryArea").focus();
    });
*/

</script>
</body>
</html>
